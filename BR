(function executeRule(current, previous /*null when async*/) {
    
    // Only proceed if we have an original invoice number
    if (!current.original_invoice_number) {
        // If invoice_number exists but original doesn't, copy it over (data migration scenario)
        if (current.invoice_number) {
            current.original_invoice_number = current.invoice_number;
        } else {
            gs.warn('Invoice submission ' + current.number + ' is missing original_invoice_number');
            return;
        }
    }

    // Use the Script Include to construct the invoice number
    var utils = new VendorProgramPortalUtilsBase();
    var constructedNumber = utils.constructInvoiceNumber(current);
    
    // Set the invoice_number field
    current.invoice_number = constructedNumber;
    
    // Log for debugging (optional - remove in production if desired)
    gs.info('Invoice Number Set: ' + current.number + ' -> ' + constructedNumber + 
            ' (Original: ' + current.original_invoice_number + ')');

})(current, previous);
